{"version":3,"sources":["../src/Cluster/BaseCluster.ts"],"names":[],"mappings":"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","file":"BaseCluster.js","sourcesContent":["/* eslint-disable @typescript-eslint/no-misused-promises */\r\nimport { ShardingManager } from '..';\r\nimport { Client, ClientOptions } from 'discord.js';\r\nimport { ShardClientUtil } from '../Sharding/ShardClientUtil';\r\nimport { IPCEvents } from '../Util/Constants';\r\nimport * as Util from '../Util/Util';\r\n\r\nexport abstract class BaseCluster {\r\n\tpublic readonly client: Client;\r\n\tpublic readonly id: number;\r\n\r\n\tpublic constructor(public manager: ShardingManager) {\r\n\t\tconst env = process.env;\r\n\t\tconst shards = env.CLUSTER_SHARDS!.split(',').map(Number);\r\n\t\tconst clientConfig: ClientOptions = Util.mergeDefault<ClientOptions>(manager.clientOptions, {\r\n\t\t\tshards,\r\n\t\t\tshardCount: Number(env.CLUSTER_SHARD_COUNT)\r\n\t\t});\r\n\t\tthis.client = new manager.client(clientConfig);\r\n\t\tconst client = this.client as any;\r\n\t\tclient.shard = new ShardClientUtil(client, manager.ipcSocket);\r\n\t\tthis.id = Number(env.CLUSTER_ID);\r\n\t}\r\n\r\n\tpublic async init() {\r\n\t\tconst shardUtil = this.client.shard! as ShardClientUtil;\r\n\t\tawait shardUtil.init();\r\n\t\tthis.client.once('ready', () => shardUtil.send({ op: IPCEvents.READY, d: this.id }, { receptive: false }));\r\n\t\tthis.client.on('shardReady', id => shardUtil.send({ op: IPCEvents.SHARDREADY, d: { id: this.id, shardID: id } }, { receptive: false }));\r\n\t\tthis.client.on('shardReconnecting', id => shardUtil.send({ op: IPCEvents.SHARDRECONNECT, d: { id: this.id, shardID: id } }, { receptive: false }));\r\n\t\tthis.client.on('shardResume', (id, replayed) => shardUtil.send({ op: IPCEvents.SHARDRESUME, d: { id: this.id, shardID: id, replayed } }, { receptive: false }));\r\n\t\tthis.client.on('shardDisconnect', ({ code, reason, wasClean }, id) => shardUtil.send({ op: IPCEvents.SHARDDISCONNECT, d: { id: this.id, shardID: id, closeEvent: { code, reason, wasClean } } }, { receptive: false }));\r\n\t\tawait this.launch();\r\n\t}\r\n\r\n\tprotected abstract launch(): Promise<void> | void;\r\n}\r\n"],"sourceRoot":"../../src"}